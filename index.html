<!DOCTYPE html>
<html>
<head>
    <title>Self-Organization Simulation</title>
</head>
<body>
    <canvas id="simulationCanvas" width="500" height="500"></canvas>

    <script>
        // Define classes for materials and agents
        class Material {
            constructor(reactivity) {
                this.reactivity = reactivity;
            }
        }

        class Agent {
            constructor(x, y) {
                this.x = x;
                this.y = y;
            }

            move() {
                // Implement agent movement
                const direction = Math.floor(Math.random() * 4); // 0: up, 1: right, 2: down, 3: left

                switch (direction) {
                    case 0:
                        if (this.y > 0) {
                            this.y--;
                        }
                        break;
                    case 1:
                        if (this.x < gridSize - 1) {
                            this.x++;
                        }
                        break;
                    case 2:
                        if (this.y < gridSize - 1) {
                            this.y++;
                        }
                        break;
                    case 3:
                        if (this.x > 0) {
                            this.x--;
                        }
                        break;
                }
            }

            react() {
                // Implement agent reaction
                const neighboringMaterial = grid[this.x][this.y + 1];

                if (neighboringMaterial instanceof Material && neighboringMaterial.reactivity > 0) {
                    // React with neighboring material
                    // Increase reactivity of the neighboring material
                    neighboringMaterial.reactivity++;
                }
            }

            reproduce() {
                // Implement agent reproduction
                const reproductionProbability = 0.1; // Adjust the probability as needed

                if (Math.random() < reproductionProbability) {
                    // Create a new agent in a random neighboring cell
                    const neighboringCells = [];

                    if (this.x > 0) {
                        neighboringCells.push({ x: this.x - 1, y: this.y });
                    }
                    if (this.x < gridSize - 1) {
                        neighboringCells.push({ x: this.x + 1, y: this.y });
                    }
                    if (this.y > 0) {
                        neighboringCells.push({ x: this.x, y: this.y - 1 });
                    }
                    if (this.y < gridSize - 1) {
                        neighboringCells.push({ x: this.x, y: this.y + 1 });
                    }

                    if (neighboringCells.length > 0) {
                        const randomIndex = Math.floor(Math.random() * neighboringCells.length);
                        const { x, y } = neighboringCells[randomIndex];

                        grid[x][y] = new Agent(x, y);
                    }
                }
            }
        }

        // Define reaction rules
        function react(material1, material2) {
            // Define reaction logic
            // Example: If material1.reactivity is greater than material2.reactivity, material1 consumes material2
            if (material1.reactivity > material2.reactivity) {
                material1.reactivity += material2.reactivity;
                material2.reactivity = 0;
            } else if (material1.reactivity < material2.reactivity) {
                material2.reactivity += material1.reactivity;
                material1.reactivity = 0;
            }
        }

        // Create the 2D grid environment
        const gridSize = 50; // Adjust the grid size as needed
        const cellSize = 10; // Adjust the cell size as needed
        const canvas = document.getElementById('simulationCanvas');
        const context = canvas.getContext('2d');

        canvas.width = gridSize * cellSize;
        canvas.height = gridSize * cellSize;

        const grid = new Array(gridSize);
        for (let i = 0; i < gridSize; i++) {
            grid[i] = new Array(gridSize);
        }

        // Implement agent behaviors
        function implementBehaviors(agent) {
            agent.move();
            agent.react();
            agent.reproduce();
        }

        // Initialize and populate the simulation
        function initializeSimulation() {
            // Add initial materials and agents to the grid
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (Math.random() < 0.1) {
                        grid[i][j] = new Material(1);
                    } else if (Math.random() < 0.05) {
                        grid[i][j] = new Agent(i, j);
                    }
                }
            }
        }

        // Run the main simulation loop
        function runSimulation() {
            // Apply agent behaviors and reaction rules
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const cell = grid[i][j];

                    if (cell instanceof Agent) {
                        implementBehaviors(cell);
                    }
                }
            }

            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const cell = grid[i][j];

                    if (cell instanceof Material && i < gridSize - 1) {
                        const neighboringCell = grid[i + 1][j];

                        if (neighboringCell instanceof Material) {
                            react(cell, neighboringCell);
                        }
                    }
                }
            }
        }

        // Collect statistics and visualize
        function collectStatistics() {
            // Monitor changes and visualize the simulation
            context.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const cell = grid[i][j];

                    if (cell instanceof Material) {
                        const color = `rgb(0, 0, ${Math.floor(cell.reactivity * 255 / 10)})`;

                        context.fillStyle = color;
                        context.fillRect(i * cellSize, j * cellSize, cellSize, cellSize);
                    } else if (cell instanceof Agent) {
                        context.fillStyle = 'rgb(0, 255, 0)';
                        context.fillRect(i * cellSize, j * cellSize, cellSize, cellSize);
                    }
                }
            }
        }

        // Call the necessary functions to execute the simulation
        function startSimulation() {
            initializeSimulation();

            // Run the simulation for a specific number of iterations or indefinitely
            const numberOfIterations = 1000; // Adjust the number of iterations as needed

            for (let i = 0; i < numberOfIterations; i++) {
                runSimulation();
                collectStatistics();
            }
        }

        // Start the simulation
        startSimulation();
    </script>
</body>
</html>
